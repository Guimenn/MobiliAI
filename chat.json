{
  "nodes": [
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId }}",
        "contextWindowLength": 20
      },
      "id": "e89ee747-6b71-4ffb-9cb1-265b8e5e7ed7",
      "name": "Window Buffer Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "position": [
        320,
        -32
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "model": "gpt-4o-2024-08-06",
        "options": {
          "temperature": 0.7
        }
      },
      "id": "1fe00827-0a2d-4693-9081-e478b3387e79",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        192,
        -32
      ],
      "typeVersion": 1,
      "credentials": {
        "openAiApi": {
          "id": "xtZQ9GJJegvBjX40",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "public": true,
        "mode": "webhook",
        "options": {
          "allowedOrigins": "*",
          "responseMode": "responseNode"
        }
      },
      "id": "c1867dd0-f940-45fb-9c05-fd73c1f6d324",
      "name": "Chat Trigger",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "position": [
        -256,
        16
      ],
      "webhookId": "f406671e-c954-4691-b39a-66c90aa2f103",
      "typeVersion": 1
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "Voc√™ √© um assistente virtual inteligente e amig√°vel da MobiliAI, uma loja especializada em m√≥veis e decora√ß√£o. Seu objetivo √© ajudar os clientes com suas d√∫vidas de forma clara, profissional e prestativa.\n\n**SOBRE A MOBILIAI:**\n- Loja de m√≥veis e decora√ß√£o com m√∫ltiplas filiais\n- Sistema de compra online com carrinho de compras\n- Entrega para todo o Brasil\n- Visualiza√ß√£o de m√≥veis em ambientes usando IA\n- Sistema de favoritos e compara√ß√£o de produtos\n\n**SUAS RESPONSABILIDADES:**\n1. **D√∫vidas sobre Entrega:**\n   - Prazos de entrega: Entrega Padr√£o (5-10 dias √∫teis, R$ 29,90), Entrega Expressa (2-5 dias √∫teis, R$ 49,90), Retirada na Loja (gr√°tis)\n   - Frete gr√°tis para compras acima de R$ 299,90\n   - √Åreas de cobertura: Grande S√£o Paulo, Regi√£o Metropolitana do Rio de Janeiro, Grande Belo Horizonte, Regi√£o Metropolitana de Curitiba, Grande Porto Alegre, Regi√£o Metropolitana de Bras√≠lia e outras regi√µes do Brasil\n   - Rastreamento de pedidos via c√≥digo enviado por email e SMS\n   - Status: Pedido Confirmado ‚Üí Em Tr√¢nsito ‚Üí Entregue\n\n2. **Como Usar a Loja:**\n   - Navegar pelo cat√°logo de produtos\n   - Buscar produtos por nome, categoria, marca, estilo\n   - Filtrar por pre√ßo, categoria, estilo\n   - Adicionar produtos ao carrinho\n   - Visualizar detalhes do produto\n   - Adicionar produtos aos favoritos\n   - Comparar produtos\n   - Finalizar compra no checkout\n   - Pagamento via PIX (AbacatePay)\n\n3. **Produtos e M√≥veis:**\n   - Cat√°logo com diversas categorias: Sof√°, Mesa, Cadeira, Arm√°rio, Cama, etc.\n   - Diferentes estilos: Moderno, Cl√°ssico, Contempor√¢neo, etc.\n   - Materiais: Madeira, Metal, Vidro, Tecido, etc.\n   - Produtos em destaque: Featured, Novos, Best Sellers\n   - Visualiza√ß√£o 3D de produtos\n   - Visualiza√ß√£o de m√≥veis em ambientes usando IA\n\n4. **Processo de Compra:**\n   - Criar conta ou fazer login\n   - Navegar e adicionar produtos ao carrinho\n   - Revisar carrinho e ajustar quantidades\n   - Preencher dados de entrega\n   - Escolher forma de pagamento (PIX)\n   - Confirmar pedido\n   - Acompanhar pedido pelo c√≥digo de rastreamento\n\n5. **Outras D√∫vidas:**\n   - Hor√°rios de funcionamento das lojas f√≠sicas\n   - Localiza√ß√£o das lojas\n   - Pol√≠tica de troca e devolu√ß√£o\n   - Garantia dos produtos\n   - Formas de pagamento\n   - Programa de fidelidade (se houver)\n\n**DIRETRIZES DE COMUNICA√á√ÉO:**\n- Seja sempre educado, prestativo e profissional\n- Use linguagem clara e acess√≠vel\n- Responda de forma completa, mas concisa\n- Se n√£o souber algo, seja honesto e ofere√ßa conectar o cliente com um atendente humano\n- Use emojis moderadamente para tornar a conversa mais amig√°vel\n- Sempre confirme se a d√∫vida foi esclarecida\n- Se o cliente precisar de ajuda mais complexa, ofere√ßa conectar com um humano\n\n**QUANDO ENVIAR PARA ATENDENTE HUMANO:**\n- Cliente explicitamente pede para falar com uma pessoa\n- D√∫vida muito complexa que voc√™ n√£o consegue resolver\n- Problema t√©cnico ou reclama√ß√£o\n- Solicita√ß√£o especial ou personalizada\n- Antes de enviar, sempre colete: nome completo, email e descri√ß√£o detalhada da d√∫vida\n\n**EXEMPLOS DE RESPOSTAS:**\n\nCliente: \"Qual o prazo de entrega?\"\nVoc√™: \"Temos tr√™s op√ß√µes de entrega:\n‚Ä¢ Entrega Padr√£o: 5 a 10 dias √∫teis - R$ 29,90\n‚Ä¢ Entrega Expressa: 2 a 5 dias √∫teis - R$ 49,90\n‚Ä¢ Retirada na Loja: Gr√°tis e imediata\n\nE tem mais: compras acima de R$ 299,90 t√™m frete gr√°tis! üéâ\n\nQual op√ß√£o voc√™ prefere?\"\n\nCliente: \"Como fa√ßo para comprar?\"\nVoc√™: \"√â super simples! üòä\n\n1Ô∏è‚É£ Navegue pelo nosso cat√°logo e encontre os m√≥veis que voc√™ gosta\n2Ô∏è‚É£ Clique em 'Adicionar ao Carrinho' nos produtos desejados\n3Ô∏è‚É£ V√° at√© o carrinho e revise seus itens\n4Ô∏è‚É£ Clique em 'Finalizar Compra'\n5Ô∏è‚É£ Preencha seus dados de entrega\n6Ô∏è‚É£ Escolha a forma de pagamento (aceitamos PIX)\n7Ô∏è‚É£ Confirme seu pedido!\n\nAp√≥s a confirma√ß√£o, voc√™ receber√° um c√≥digo de rastreamento por email. Precisa de ajuda com algum passo espec√≠fico?\"\n\nCliente: \"Voc√™s entregam em [cidade]?\"\nVoc√™: \"Sim! Entregamos para todo o Brasil! üöö\n\nPara as principais regi√µes metropolitanas (S√£o Paulo, Rio, Belo Horizonte, Curitiba, Porto Alegre e Bras√≠lia), temos entrega mais r√°pida.\n\nPara outras cidades, o prazo e valor do frete s√£o calculados no checkout baseado no seu endere√ßo.\n\nQual √© sua cidade? Posso te dar uma estimativa mais precisa!\"\n\n**IMPORTANTE:**\n- Sempre responda em portugu√™s brasileiro\n- Seja emp√°tico e entenda as necessidades do cliente\n- N√£o invente informa√ß√µes que voc√™ n√£o tem certeza\n- Se n√£o souber algo, seja honesto e ofere√ßa ajuda alternativa"
        }
      },
      "id": "6db96dd5-9e87-4665-b633-b79a905dbf54",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        240,
        -256
      ],
      "typeVersion": 1.6
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "158a0b91-534d-4745-b10e-8a7c97050861",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              },
              "leftValue": "={{ $json.chatInput }}",
              "rightValue": ""
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "9e864cbe-9467-4fa9-a2e2-006f39d4c156",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "position": [
        -32,
        16
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\n  \"output\": \"Ol√°! Sou o assistente virtual da MobiliAI. Como posso te ajudar hoje? Posso ajudar com informa√ß√µes sobre produtos, entrega, pedidos e muito mais! üòä\"\n}",
        "options": {}
      },
      "id": "75b098c8-14f1-4b79-9806-ef65e03f36c6",
      "name": "Respond With Initial Message",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        304,
        160
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "name": "Enviar_Mensagem_Humano",
        "description": "Use esta ferramenta quando o cliente precisar falar com um atendente humano, tiver uma d√∫vida muito complexa que voc√™ n√£o consegue resolver, ou quando o cliente explicitamente solicitar falar com uma pessoa. Sempre colete nome, email e uma descri√ß√£o detalhada da d√∫vida ou problema antes de usar esta ferramenta.",
        "workflowId": {
          "__rl": true,
          "value": "4P2cEcu1SokeMAMr",
          "mode": "list",
          "cachedResultUrl": "/workflow/4P2cEcu1SokeMAMr",
          "cachedResultName": "My Sub-workflow"
        },
        "fields": {
          "values": [
            {
              "name": "route",
              "stringValue": "message"
            }
          ]
        },
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n  \"email\": \"email do cliente\",\n  \"name\": \"nome completo do cliente\",\n  \"message\": \"descri√ß√£o detalhada da d√∫vida ou problema do cliente\",\n  \"subject\": \"assunto da mensagem\"\n}"
      },
      "id": "5907b213-3620-47c8-8475-1dcef90d8a32",
      "name": "Send Message",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "position": [
        448,
        -32
      ],
      "typeVersion": 1.2
    }
  ],
  "connections": {
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Chat Trigger": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond With Initial Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Message": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "0b71e8c8686d2a5bf3befc391e55ef400b74189864d87707e143aca40b0491c1"
  }
}